<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Limas 3D Interaktif ‚Ä¢ Diagonal Bidang, Diagonal Ruang, Bidang Diagonal</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 10%, #7c9cf7 0%, #6b78f0 30%, #5b4fa8 100%);
      color: #1f2937;
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      padding: 20px;
    }
    .header { color: #fff; text-align: center; margin-bottom: 16px; }
    .header h1 { font-size: 28px; margin: 0 0 8px; }
    .header p { opacity: 0.95; margin: 0; }

    .intro { margin: 20px 0; }
    .intro h3 { margin: 0 0 12px; color: #111827; font-size: 20px; }
    .intro-grid {
      display: grid; gap: 16px; grid-template-columns: repeat(2, minmax(0,1fr));
    }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; background: #eef2ff; color: #3730a3; margin-right: 8px; }

    .layout {
      display: grid; gap: 20px; grid-template-columns: 1.2fr 0.8fr; margin-top: 16px;
    }
    @media (max-width: 1024px) { .layout { grid-template-columns: 1fr; } }

    #threejs-container {
      width: 100%; height: 480px; border-radius: 12px; overflow: hidden; background: #f8fafc; border: 2px solid #eef2f7;
    }
    .hint-panel {
      display: grid; gap: 10px; grid-template-columns: repeat(3, minmax(0,1fr));
      margin-top: 12px;
    }
    .toggle {
      display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 10px;
      background: #f3f4f6; border: 2px solid #e5e7eb; cursor: pointer; user-select: none;
      transition: transform .1s ease, background .2s ease, border-color .2s ease;
    }
    .toggle:hover { transform: translateY(-1px); background: #eef2ff; border-color: #c7d2fe; }
    .toggle input { width: 18px; height: 18px; }
    .legend {
      display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px; font-size: 13px; color: #374151;
    }
    .legend span { display: inline-flex; align-items: center; gap: 8px; }
    .dot { width: 12px; height: 12px; border-radius: 999px; display: inline-block; border: 2px solid #000; }
    .dot-yellow { background: #fbbf24; border-color: #9a7b00; }
    .dot-pink { background: #ec4899; border-color: #8a1d50; }
    .dot-purple { background: #a855f7; border-color: #5b21b6; }

    .panel-title { font-weight: 700; color: #111827; margin: 0 0 8px; font-size: 16px; }
    .subtle { font-size: 13px; color: #6b7280; margin-top: 6px; }

    .btn-grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    .btn {
      padding: 10px 12px; border: 2px solid #e5e7eb; background: #f9fafb; border-radius: 10px;
      cursor: pointer; transition: all .2s ease; text-align: center; font-weight: 600; color: #1f2937;
    }
    .btn:hover { background: #eef2ff; border-color: #c7d2fe; transform: translateY(-1px); }
    .btn.active { background: #4338ca; color: #fff; border-color: #3730a3; }

    .q-card { background: #f9fafb; border-radius: 12px; border-left: 4px solid #4f46e5; padding: 14px; margin-bottom: 16px; }
    .q-card label { display: block; font-weight: 600; margin-bottom: 6px; color: #111827; }
    .q-card small { display: block; color: #6b7280; margin-bottom: 8px; }
    .input-row { display: flex; gap: 8px; align-items: center; }
    .input { width: 110px; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
    .input:focus { outline: none; border-color: #6366f1; background: #eef2ff; }
    .primary { padding: 8px 12px; border-radius: 8px; background: #4f46e5; color: #fff; border: none; font-weight: 700; cursor: pointer; }
    .primary:hover { background: #4338ca; }

    .feedback { margin-top: 8px; padding: 8px 10px; border-radius: 8px; display: none; font-weight: 600; }
    .ok { display: block; background: #dcfce7; color: #166534; border: 1px solid #86efac; }
    .no { display: block; background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: center; }
    th { background: #4338ca; color: #fff; }
    tr:nth-child(even) td { background: #f9fafb; }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 20px; background: #111827; color: #fff; padding: 10px 14px; border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25); font-size: 14px; display: none; z-index: 50;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üî∫ Limas 3D Interaktif</h1>
      <p>Putar, zoom, dan nyalakan petunjuk untuk memahami Diagonal Bidang, Diagonal Ruang, dan Bidang Diagonal pada limas.</p>
    </div>

    <div class="card intro">
      <h3>üìö Apa itu Limas?</h3>
      <p><span class="pill">Definisi</span><strong>Limas</strong> adalah bangun ruang dengan satu alas berbentuk segi-n dan sisi-sisi tegak berbentuk segitiga yang bertemu di satu titik puncak.</p>
      <div class="intro-grid">
        <div class="card" style="background:#f8fafc;">
          <h4 class="panel-title">üè† Contoh sehari-hari</h4>
          <ul style="margin:8px 0 0; padding-left:18px; color:#374151;">
            <li>Limas Segitiga: tetrahedron</li>
            <li>Limas Segiempat: piramida Mesir</li>
            <li>Limas Segilima: ujung ornamen</li>
          </ul>
        </div>
        <div class="card" style="background:#f8fafc;">
          <h4 class="panel-title">üîç Istilah kunci</h4>
          <ul style="margin:8px 0 0; padding-left:18px; color:#374151;">
            <li><strong>Diagonal Bidang</strong>: Garis lurus yang berada di dalam satu sisi bangun ruang. Pada limas, diagonal bidang hanya muncul di bidang alas (sisi tegak segitiga tidak memiliki diagonal).</li>
            <li><strong>Diagonal Ruang</strong>: Garis lurus yang menghubungkan dua titik sudut yang tidak satu bidang/sisi dan melintasi bagian dalam bangun. Pada limas, tidak ada diagonal ruang.</li>
            <li><strong>Bidang Diagonal</strong>: Daerah yang dibatasi dua diagonal bidang dan dua rusuk yang berhadapan. Pada limas, bidang diagonal tidak terbentuk.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="layout">
      <div class="card">
        <h4 class="panel-title">üéØ Model 3D Interaktif</h4>
        <div id="threejs-container"></div>
        <div class="hint-panel" style="margin-top:12px;">
          <label class="toggle">
            <input type="checkbox" id="toggle-face-diag"/>
            <div><strong>Diagonal Bidang</strong><div class="subtle">Menyorot diagonal di alas</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-space-diag"/>
            <div><strong>Diagonal Ruang</strong><div class="subtle">Tidak ada pada limas</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-diagonal-plane"/>
            <div><strong>Bidang Diagonal</strong><div class="subtle">Tidak ada pada limas</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-faces" checked/>
            <div><strong>Tampilkan Sisi</strong><div class="subtle">Warnai semua sisi</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-edges" checked/>
            <div><strong>Tampilkan Rusuk</strong><div class="subtle">Hanya garis tepi asli</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-vertices"/>
            <div><strong>Tampilkan Titik Sudut</strong><div class="subtle">Titik di setiap sudut</div></div>
          </label>
        </div>
        <div class="legend">
          <span><i class="dot dot-yellow"></i> Diagonal Bidang (alas)</span>
          <span><i class="dot dot-pink"></i> Diagonal Ruang</span>
          <span><i class="dot dot-purple"></i> Bidang Diagonal</span>
          <span><i class="dot" style="background:#9ec5fe;border-color:#4b5563"></i> Sisi</span>
          <span><i class="dot" style="background:#111;border-color:#111"></i> Rusuk</span>
          <span><i class="dot" style="background:#10b981;border-color:#065f46"></i> Titik Sudut</span>
        </div>
        <p class="subtle">Tip: Klik‚Äìseret untuk memutar, gulir untuk zoom, klik kanan‚Äìseret untuk menggeser.</p>
      </div>

      <div class="card">
        <h4 class="panel-title">üîß Pilih Jenis Limas</h4>
        <div class="btn-grid" style="margin-bottom:12px;">
          <button class="btn active" data-shape="triangle">Limas Segitiga</button>
          <button class="btn" data-shape="square">Limas Segiempat</button>
          <button class="btn" data-shape="pentagon">Limas Segilima</button>
          <button class="btn" data-shape="hexagon">Limas Segienam</button>
          <button class="btn" data-shape="octagon">Limas Segidelapan</button>
          <button class="btn" data-shape="decagon">Limas Sepuluh</button>
        </div>

        <div class="q-card">
          <label>Sedang mengamati: <span id="shape-name" style="color:#4f46e5;">Limas Segitiga</span></label>
          <small>Gunakan saklar di kiri untuk menyorot bagian-bagian bangun.</small>
        </div>

        <div class="q-card">
          <label>üî∏ Berapa jumlah sisi alas?</label>
          <small>(Hitung sisi pada bidang alas)</small>
          <div class="input-row">
            <input id="sides-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('sides')">Cek</button>
          </div>
          <div id="sides-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üîπ Berapa jumlah bidang sisi?</label>
          <small>(Alas + semua sisi tegak segitiga)</small>
          <div class="input-row">
            <input id="faces-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('faces')">Cek</button>
          </div>
          <div id="faces-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üìè Berapa jumlah rusuk?</label>
          <small>(Garis tepi pertemuan dua bidang)</small>
          <div class="input-row">
            <input id="edges-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('edges')">Cek</button>
          </div>
          <div id="edges-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üìç Berapa jumlah titik sudut?</label>
          <small>(Titik pertemuan tiga atau lebih rusuk)</small>
          <div class="input-row">
            <input id="vertices-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('vertices')">Cek</button>
          </div>
          <div id="vertices-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>‚ÜóÔ∏è Berapa jumlah diagonal bidang?</label>
          <small>(Pada limas, hanya ada di bidang alas)</small>
          <div class="input-row">
            <input id="face-diagonals-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('faceDiagonals')">Cek</button>
          </div>
          <div id="face-diagonals-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>‚ú® Berapa jumlah diagonal ruang?</label>
          <small>(Pada limas, tidak ada)</small>
          <div class="input-row">
            <input id="space-diagonals-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('spaceDiagonals')">Cek</button>
          </div>
          <div id="space-diagonals-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üü™ Berapa jumlah bidang diagonal?</label>
          <small>(Pada limas, tidak ada)</small>
          <div class="input-row">
            <input id="diagonal-planes-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('diagonalPlanes')">Cek</button>
          </div>
          <div id="diagonal-planes-feedback" class="feedback"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <h4 class="panel-title">üßÆ Temukan Pola dan Rumus!</h4>
      <p class="subtle">Isi tabel ketika jawabanmu benar. Lihat polanya lalu lengkapi rumus umum limas segi-n.</p>
      <div style="overflow:auto; border:1px solid #e5e7eb; border-radius:12px;">
        <table>
          <thead>
            <tr>
              <th>Jenis Limas</th>
              <th>Sisi Alas (n)</th>
              <th>Bidang Sisi</th>
              <th>Rusuk</th>
              <th>Titik Sudut</th>
              <th>Diagonal Bidang</th>
              <th>Diagonal Ruang</th>
              <th>Bidang Diagonal</th>
            </tr>
          </thead>
          <tbody id="formula-table-body"></tbody>
        </table>
      </div>

      <div style="margin-top:14px; padding:12px; border:2px solid #e5e7eb; border-radius:12px;">
        <h4 class="panel-title">üéØ Rumus Limas Segi-n</h4>
        <div style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); margin-top:8px;">
          <div class="q-card" style="margin:0;">
            <label>Bidang Sisi =</label>
            <div class="input-row">
              <input id="faces-formula" class="input" placeholder="n + ?"/>
              <button class="primary" onclick="checkFormula('faces')">Cek</button>
            </div>
            <div id="faces-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Rusuk =</label>
            <div class="input-row">
              <input id="edges-formula" class="input" placeholder="?n"/>
              <button class="primary" onclick="checkFormula('edges')">Cek</button>
            </div>
            <div id="edges-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Titik Sudut =</label>
            <div class="input-row">
              <input id="vertices-formula" class="input" placeholder="n + ?"/>
              <button class="primary" onclick="checkFormula('vertices')">Cek</button>
            </div>
            <div id="vertices-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Diagonal Bidang =</label>
            <div class="input-row">
              <input id="base-diag-formula" class="input" placeholder="n(n-?)/?"/>
              <button class="primary" onclick="checkFormula('baseDiag')">Cek</button>
            </div>
            <div id="base-diag-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Diagonal Ruang =</label>
            <div class="input-row">
              <input id="space-diag-formula" class="input" placeholder="0"/>
              <button class="primary" onclick="checkFormula('spaceDiag')">Cek</button>
            </div>
            <div id="space-diag-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Bidang Diagonal =</label>
            <div class="input-row">
              <input id="plane-formula" class="input" placeholder="0"/>
              <button class="primary" onclick="checkFormula('plane')">Cek</button>
            </div>
            <div id="plane-formula-feedback" class="feedback"></div>
          </div>
        </div>

        <div id="final-formulas" style="display:none; margin-top:12px; background:linear-gradient(135deg,#eef2ff,#ecfdf5); padding:12px; border-radius:12px; border:2px solid #d1fae5;">
          <h4 class="panel-title">üéâ Rumus Umum Limas Segi-n</h4>
          <div style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(180px,1fr));">
            <div class="card" style="margin:0; background:#fff;">Bidang Sisi: <strong style="color:#4338ca;">n + 1</strong></div>
            <div class="card" style="margin:0; background:#fff;">Rusuk: <strong style="color:#4338ca;">2n</strong></div>
            <div class="card" style="margin:0; background:#fff;">Titik Sudut: <strong style="color:#4338ca;">n + 1</strong></div>
            <div class="card" style="margin:0; background:#fff;">Diagonal Bidang: <strong style="color:#4338ca;">n(n‚àí3)/2</strong></div>
            <div class="card" style="margin:0; background:#fff;">Diagonal Ruang: <strong style="color:#4338ca;">0</strong></div>
            <div class="card" style="margin:0; background:#fff;">Bidang Diagonal: <strong style="color:#4338ca;">0</strong></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    let scene, camera, renderer, controls;
    let currentGroup = null;
    let currentShapeType = 'triangle';
    let completedShapes = new Set();
    let correctFormulas = 0;

    let baseVertices = [];
    let apex = null;

    // Data limas segi-n
    // faces = n + 1, edges = 2n, vertices = n + 1
    // diagonal bidang (alas) = n(n-3)/2
    // diagonal ruang = 0, bidang diagonal = 0
    const shapeData = {
      triangle: { name: 'Limas Segitiga', sides: 3, faces: 4, edges: 6, vertices: 4, faceDiagonals: 0, spaceDiagonals: 0, diagonalPlanes: 0 },
      square:   { name: 'Limas Segiempat', sides: 4, faces: 5, edges: 8, vertices: 5, faceDiagonals: 2, spaceDiagonals: 0, diagonalPlanes: 0 },
      pentagon: { name: 'Limas Segilima', sides: 5, faces: 6, edges:10, vertices: 6, faceDiagonals: 5, spaceDiagonals: 0, diagonalPlanes: 0 },
      hexagon:  { name: 'Limas Segienam', sides: 6, faces: 7, edges:12, vertices: 7, faceDiagonals: 9, spaceDiagonals: 0, diagonalPlanes: 0 },
      octagon:  { name: 'Limas Segidelapan', sides: 8, faces: 9, edges:16, vertices: 9, faceDiagonals:20, spaceDiagonals: 0, diagonalPlanes: 0 },
      decagon:  { name: 'Limas Sepuluh', sides:10, faces:11, edges:20, vertices:11, faceDiagonals:35, spaceDiagonals: 0, diagonalPlanes: 0 }
    };

    function showToast(msg, ms = 2200) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.display = 'block';
      setTimeout(() => { t.style.display = 'none'; }, ms);
    }

    function initThree() {
      const container = document.getElementById('threejs-container');
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf5f7fb);

      camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(6, 5.5, 6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;

      const amb = new THREE.AmbientLight(0xffffff, 0.7);
      scene.add(amb);
      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(5, 10, 6);
      scene.add(dir);

      createPyramid('triangle');
      animate();

      window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });

      // Toggle bindings
      document.addEventListener('change', onToggleChange);
      document.addEventListener('click', onShapeClick);
    }

    function onToggleChange(e) {
      if (!currentGroup) return;

      if (e.target.id === 'toggle-face-diag') {
        if (e.target.checked) {
          const g = buildBaseDiagonals();
          if (g) {
            currentGroup.userData.faceDiag = g;
            scene.add(g);
          } else {
            showToast('Limas segitiga tidak memiliki diagonal bidang pada alas.');
            e.target.checked = false;
          }
        } else if (currentGroup.userData.faceDiag) {
          scene.remove(currentGroup.userData.faceDiag);
          currentGroup.userData.faceDiag = null;
        }
      }

      if (e.target.id === 'toggle-space-diag') {
        if (e.target.checked) {
          showToast('Pada limas, diagonal ruang tidak ada.');
          setTimeout(()=>{ e.target.checked = false; }, 300);
        }
      }

      if (e.target.id === 'toggle-diagonal-plane') {
        if (e.target.checked) {
          showToast('Pada limas, bidang diagonal tidak ada.');
          setTimeout(()=>{ e.target.checked = false; }, 300);
        }
      }

      if (e.target.id === 'toggle-show-faces') {
        currentGroup.userData.mesh.visible = e.target.checked;
      }
      if (e.target.id === 'toggle-show-edges') {
        currentGroup.userData.wire.visible = e.target.checked; // hanya rusuk asli; tidak menampilkan diagonal
      }
      if (e.target.id === 'toggle-show-vertices') {
        currentGroup.userData.verts.visible = e.target.checked;
      }
    }

    function onShapeClick(e) {
      const btn = e.target.closest('.btn[data-shape]');
      if (!btn) return;
      document.querySelectorAll('.btn[data-shape]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      createPyramid(btn.dataset.shape);
    }

    function createPyramid(shapeType) {
      // Hapus grup lama
      if (currentGroup) scene.remove(currentGroup);

      // Reset toggles (kecuali Sisi & Rusuk tetap aktif default)
      ['toggle-face-diag','toggle-space-diag','toggle-diagonal-plane','toggle-show-vertices'].forEach(id=>{
        const el = document.getElementById(id); if (el) el.checked = false;
      });
      document.getElementById('toggle-show-faces').checked = true;
      document.getElementById('toggle-show-edges').checked = true;

      currentShapeType = shapeType;
      const n = shapeData[shapeType].sides;
      const radius = 1.6;
      const height = 3;

      baseVertices = [];
      for (let i = 0; i < n; i++) {
        const a = (i / n) * Math.PI * 2;
        baseVertices.push(new THREE.Vector3(Math.cos(a) * radius, 0, Math.sin(a) * radius));
      }
      apex = new THREE.Vector3(0, height, 0);

      // Bangun geometri limas
      const verts = [];
      baseVertices.forEach(v => verts.push(v.x, v.y, v.z));
      verts.push(apex.x, apex.y, apex.z);

      const indices = [];
      // alas (poligon kipas, termasuk segitiga untuk n=3)
      for (let i = 1; i < n - 1; i++) indices.push(0, i, i + 1);
      // sisi segitiga
      for (let i = 0; i < n; i++) indices.push(i, (i + 1) % n, n);

      const geom = new THREE.BufferGeometry();
      geom.setAttribute('position', new THREE.Float32BufferAttribute(verts, 3));
      geom.setIndex(indices);
      geom.computeVertexNormals();

      const group = new THREE.Group();
      const mesh = new THREE.Mesh(
        geom,
        new THREE.MeshLambertMaterial({ color: 0x9ec5fe, transparent: true, opacity: 0.85, side: THREE.DoubleSide })
      );
      group.add(mesh);

      // Wireframe HANYA RUSUK asli (tanpa diagonal)
      const wire = new THREE.LineSegments(
        new THREE.EdgesGeometry(geom),
        new THREE.LineBasicMaterial({ color: 0x111111, linewidth: 2 })
      );
      group.add(wire);

      // Titik sudut
      const vertsGroup = new THREE.Group();
      const vmat = new THREE.MeshBasicMaterial({ color: 0x10b981 });
      const sph = new THREE.SphereGeometry(0.06, 16, 16);
      [...baseVertices, apex].forEach(p=>{
        const s = new THREE.Mesh(sph, vmat);
        s.position.copy(p);
        vertsGroup.add(s);
      });
      vertsGroup.visible = false; // default non-aktif
      group.add(vertsGroup);

      // simpan referensi
      group.userData = { mesh, wire, verts: vertsGroup, faceDiag: null };
      currentGroup = group;
      scene.add(group);

      // Update judul & reset jawaban
      document.getElementById('shape-name').textContent = shapeData[shapeType].name;
      resetInputs();
    }

    function buildBaseDiagonals() {
      const n = baseVertices.length;
      if (n < 4) return null; // tidak ada diagonal di alas segitiga
      const color = 0xfbbf24;
      const g = new THREE.Group();
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          const neighbor = (j === i + 1) || (i === 0 && j === n - 1);
          if (neighbor) continue;
          g.add(lineBetween(baseVertices[i], baseVertices[j], color));
        }
      }
      return g;
    }

    function lineBetween(p1, p2, color) {
      const geo = new THREE.BufferGeometry().setFromPoints([p1, p2]);
      const mat = new THREE.LineBasicMaterial({ color, linewidth: 3 });
      return new THREE.Line(geo, mat);
    }

    // Interaksi Q&A
    function feedback(el, ok, msg) {
      el.className = 'feedback ' + (ok ? 'ok' : 'no');
      el.textContent = msg;
    }

    function checkAnswer(property) {
      let id, fb;
      if (property === 'faceDiagonals') { id = 'face-diagonals-input'; fb = 'face-diagonals-feedback'; }
      else if (property === 'spaceDiagonals') { id = 'space-diagonals-input'; fb = 'space-diagonals-feedback'; }
      else if (property === 'diagonalPlanes') { id = 'diagonal-planes-input'; fb = 'diagonal-planes-feedback'; }
      else { id = property + '-input'; fb = property + '-feedback'; }

      const input = document.getElementById(id);
      const feed = document.getElementById(fb);
      const user = parseInt(input.value, 10);
      const correct = shapeData[currentShapeType][property];

      if (user === correct) {
        feedback(feed, true, '‚úÖ Benar! Keren.');
        input.disabled = true; input.style.background = '#ecfdf5';
        setTimeout(checkAllAnswersComplete, 120);
      } else {
        let tip = '';
        if (property === 'faceDiagonals') tip = 'Nyalakan ‚ÄúDiagonal Bidang‚Äù lalu hitung garis kuning pada alas.';
        if (property === 'spaceDiagonals') tip = 'Pada limas tidak ada diagonal ruang, coba isi 0.';
        if (property === 'diagonalPlanes') tip = 'Pada limas tidak ada bidang diagonal, coba isi 0.';
        feedback(feed, false, '‚ùå Belum tepat. ' + tip);
      }
    }

    function checkAllAnswersComplete() {
      const props = ['sides','faces','edges','vertices','faceDiagonals','spaceDiagonals','diagonalPlanes'];
      let all = true;
      props.forEach(p => {
        const id = (p === 'faceDiagonals') ? 'face-diagonals-input'
                : (p === 'spaceDiagonals') ? 'space-diagonals-input'
                : (p === 'diagonalPlanes') ? 'diagonal-planes-input'
                : (p + '-input');
        if (!document.getElementById(id).disabled) all = false;
      });
      if (all && !completedShapes.has(currentShapeType)) {
        completedShapes.add(currentShapeType);
        addToTable();
      }
    }

    function addToTable() {
      const tb = document.getElementById('formula-table-body');
      const d = shapeData[currentShapeType];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${d.name.replace('Limas ', '')}</td>
        <td>${d.sides}</td>
        <td>${d.faces}</td>
        <td>${d.edges}</td>
        <td>${d.vertices}</td>
        <td>${d.faceDiagonals}</td>
        <td>${d.spaceDiagonals}</td>
        <td>${d.diagonalPlanes}</td>
      `;
      tb.appendChild(tr);
      tr.style.background = '#fff7ed';
      setTimeout(()=>{ tr.style.background = ''; }, 1600);
    }

    function resetInputs() {
      const pairs = [
        ['sides-input','sides-feedback'],
        ['faces-input','faces-feedback'],
        ['edges-input','edges-feedback'],
        ['vertices-input','vertices-feedback'],
        ['face-diagonals-input','face-diagonals-feedback'],
        ['space-diagonals-input','space-diagonals-feedback'],
        ['diagonal-planes-input','diagonal-planes-feedback'],
      ];
      pairs.forEach(([inp, fb]) => {
        const el = document.getElementById(inp);
        const fe = document.getElementById(fb);
        el.value=''; el.disabled=false; el.style.background='';
        fe.className='feedback'; fe.textContent='';
      });
    }

    function checkFormula(type) {
      const id = (type === 'faces') ? 'faces-formula'
              : (type === 'edges') ? 'edges-formula'
              : (type === 'vertices') ? 'vertices-formula'
              : (type === 'baseDiag') ? 'base-diag-formula'
              : (type === 'spaceDiag') ? 'space-diag-formula'
              : 'plane-formula';
      const fb = id + '-feedback';
      const input = document.getElementById(id);
      const feed = document.getElementById(fb);
      const ans = (input.value || '').toLowerCase().replace(/\s/g,'');

      let correct = '';
      if (type === 'faces') correct = 'n+1';
      if (type === 'edges') correct = '2n';
      if (type === 'vertices') correct = 'n+1';
      if (type === 'baseDiag') correct = 'n(n-3)/2';
      if (type === 'spaceDiag') correct = '0';
      if (type === 'plane') correct = '0';

      if (ans === correct) {
        feed.className = 'feedback ok';
        feed.textContent = '‚úÖ Benar!';
        input.disabled = true; input.style.background = '#ecfdf5';
        correctFormulas++;
        if (correctFormulas === 6) document.getElementById('final-formulas').style.display = 'block';
      } else {
        feed.className = 'feedback no';
        feed.textContent = '‚ùå Coba cocokkan dengan pola di tabel.';
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    window.addEventListener('load', initThree);
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980e02ff44dfcec6',t:'MTc1ODE2ODgxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
