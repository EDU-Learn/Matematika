<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prisma 3D Interaktif + Diagonal Bidang, Diagonal Ruang, Bidang Diagonal</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 10%, #7c9cf7 0%, #6b78f0 30%, #5b4fa8 100%);
      color: #1f2937;
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15);
      padding: 20px;
    }
    .header { color: #fff; text-align: center; margin-bottom: 16px; }
    .header h1 { font-size: 28px; margin: 0 0 8px; }
    .header p { opacity: 0.95; margin: 0; }

    .intro { margin: 20px 0; }
    .intro h3 { margin: 0 0 12px; color: #111827; font-size: 20px; }
    .intro-grid {
      display: grid; gap: 16px; grid-template-columns: repeat(2, minmax(0,1fr));
    }
    .pill { display: inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; background: #eef2ff; color: #3730a3; margin-right: 8px; }

    .layout {
      display: grid; gap: 20px; grid-template-columns: 1.2fr 0.8fr; margin-top: 16px;
    }
    @media (max-width: 1024px) { .layout { grid-template-columns: 1fr; } }

    #threejs-container {
      width: 100%; height: 480px; border-radius: 12px; overflow: hidden; background: #f8fafc; border: 2px solid #eef2f7;
    }
    .hint-panel {
      display: grid; gap: 10px; grid-template-columns: repeat(3, minmax(0,1fr));
      margin-top: 12px;
    }
    .toggle {
      display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 10px;
      background: #f3f4f6; border: 2px solid #e5e7eb; cursor: pointer; user-select: none;
      transition: transform .1s ease, background .2s ease, border-color .2s ease;
    }
    .toggle:hover { transform: translateY(-1px); background: #eef2ff; border-color: #c7d2fe; }
    .toggle input { width: 18px; height: 18px; }
    .legend {
      display: flex; gap: 16px; flex-wrap: wrap; margin-top: 8px; font-size: 13px; color: #374151;
    }
    .legend span { display: inline-flex; align-items: center; gap: 8px; }
    .dot { width: 12px; height: 12px; border-radius: 999px; display: inline-block; border: 2px solid #000; }
    .dot-yellow { background: #fbbf24; border-color: #9a7b00; }
    .dot-pink { background: #ec4899; border-color: #8a1d50; }
    .dot-purple { background: #a855f7; border-color: #5b21b6; }

    .panel-title { font-weight: 700; color: #111827; margin: 0 0 8px; font-size: 16px; }
    .subtle { font-size: 13px; color: #6b7280; margin-top: 6px; }

    .btn-grid { display: grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap: 10px; }
    .btn {
      padding: 10px 12px; border: 2px solid #e5e7eb; background: #f9fafb; border-radius: 10px;
      cursor: pointer; transition: all .2s ease; text-align: center; font-weight: 600; color: #1f2937;
    }
    .btn:hover { background: #eef2ff; border-color: #c7d2fe; transform: translateY(-1px); }
    .btn.active { background: #4338ca; color: #fff; border-color: #3730a3; }

    .q-card { background: #f9fafb; border-radius: 12px; border-left: 4px solid #4f46e5; padding: 14px; margin-bottom: 16px; }
    .q-card label { display: block; font-weight: 600; margin-bottom: 6px; color: #111827; }
    .q-card small { display: block; color: #6b7280; margin-bottom: 8px; }
    .input-row { display: flex; gap: 8px; align-items: center; }
    .input { width: 110px; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; }
    .input:focus { outline: none; border-color: #6366f1; background: #eef2ff; }
    .primary { padding: 8px 12px; border-radius: 8px; background: #4f46e5; color: #fff; border: none; font-weight: 700; cursor: pointer; }
    .primary:hover { background: #4338ca; }

    .feedback { margin-top: 8px; padding: 8px 10px; border-radius: 8px; display: none; font-weight: 600; }
    .ok { display: block; background: #dcfce7; color: #166534; border: 1px solid #86efac; }
    .no { display: block; background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: center; }
    th { background: #4338ca; color: #fff; }
    tr:nth-child(even) td { background: #f9fafb; }

    .toast {
      position: fixed; left: 50%; transform: translateX(-50%);
      bottom: 20px; background: #111827; color: #fff; padding: 10px 14px; border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25); font-size: 14px; display: none; z-index: 50;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üî∑ Prisma 3D Interaktif</h1>
      <p>Putar, zoom, dan nyalakan petunjuk untuk memahami Diagonal Bidang, Diagonal Ruang, dan Bidang Diagonal.</p>
    </div>

    <div class="card intro">
      <h3>üìö Apa itu Prisma?</h3>
      <p><span class="pill">Definisi</span><strong>Prisma</strong> adalah bangun ruang dengan dua bidang sejajar dan kongruen (alas‚Äìtutup) serta sisi-sisi tegak berbentuk persegi panjang yang menghubungkan keduanya.</p>
      <div class="intro-grid">
        <div class="card" style="background:#f8fafc;">
          <h4 class="panel-title">üè† Contoh sehari-hari</h4>
          <ul style="margin:8px 0 0; padding-left:18px; color:#374151;">
            <li>Prisma Segitiga: tenda, atap loteng</li>
            <li>Prisma Segiempat (balok/kubus): kardus, kotak sepatu</li>
            <li>Prisma Segilima: batang pensil segilima</li>
          </ul>
        </div>
        <div class="card" style="background:#f8fafc;">
          <h4 class="panel-title">üîç Istilah kunci</h4>
          <ul style="margin:8px 0 0; padding-left:18px; color:#374151;">
            <li><strong>Diagonal Bidang</strong>: Garis lurus yang berada di dalam satu sisi bangun ruang.</li>
            <li><strong>Diagonal Ruang</strong>: Garis lurus yang menghubungkan dua titik sudut yang tidak satu bidang atau sisi, dan melintasi bagian dalam bangun ruang.</li>
            <li><strong>Bidang Diagonal</strong>: Sebuah daerah yang dibatasi oleh dua diagonal bidang dan dua rusuk yang berhadapan di dalam ruang bangun ruang.</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="layout">
      <div class="card">
        <h4 class="panel-title">üéØ Model 3D Interaktif</h4>
        <div id="threejs-container"></div>
        <div class="hint-panel" style="margin-top:12px;">
          <label class="toggle">
            <input type="checkbox" id="toggle-base-diag"/>
            <div><strong>Diagonal Bidang</strong><div class="subtle">Menyorot diagonal pada semua sisi</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-space-diag"/>
            <div><strong>Diagonal Ruang</strong><div class="subtle">Garis melintas di dalam bangun</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-diagonal-plane"/>
            <div><strong>Bidang Diagonal</strong><div class="subtle">Bidang transparan ungu</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-faces"/>
            <div><strong>Tampilkan Sisi</strong><div class="subtle">Warnai semua sisi lembut</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-edges"/>
            <div><strong>Tampilkan Rusuk</strong><div class="subtle">Sorot seluruh rusuk</div></div>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-show-vertices"/>
            <div><strong>Tampilkan Titik Sudut</strong><div class="subtle">Munculkan titik di setiap sudut</div></div>
          </label>
        </div>
        <div class="legend">
          <span><i class="dot dot-yellow"></i> Diagonal Bidang (semua sisi)</span>
          <span><i class="dot dot-pink"></i> Diagonal Ruang</span>
          <span><i class="dot dot-purple"></i> Bidang Diagonal</span>
          <span><i class="dot" style="background:#9ec5fe;border-color:#4b5563"></i> Sisi</span>
          <span><i class="dot" style="background:#111;border-color:#111"></i> Rusuk</span>
          <span><i class="dot" style="background:#10b981;border-color:#065f46"></i> Titik Sudut</span>
        </div>
        <p class="subtle">Tip: Klik‚Äìseret untuk memutar, gulir untuk zoom, klik kanan‚Äìseret untuk menggeser.</p>
      </div>

      <div class="card">
        <h4 class="panel-title">üîß Pilih Jenis Prisma</h4>
        <div class="btn-grid" style="margin-bottom:12px;">
          <button class="btn active" data-shape="triangle">Prisma Segitiga</button>
          <button class="btn" data-shape="square">Prisma Segiempat</button>
          <button class="btn" data-shape="pentagon">Prisma Segilima</button>
          <button class="btn" data-shape="hexagon">Prisma Segienam</button>
          <button class="btn" data-shape="octagon">Prisma Segidelapan</button>
          <button class="btn" data-shape="decagon">Prisma Sepuluh</button>
        </div>

        <div class="q-card">
          <label>Sedang mengamati: <span id="shape-name" style="color:#4f46e5;">Prisma Segitiga</span></label>
          <small>Amati warna tiap sisi dan garis tepi hitam untuk membantu menghitung.</small>
        </div>

        <div class="q-card">
          <label>üî∏ Berapa jumlah sisi alas?</label>
          <small>(Hitung sisi pada bidang alas/tutup)</small>
          <div class="input-row">
            <input id="sides-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('sides')">Cek</button>
          </div>
          <div id="sides-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üîπ Berapa jumlah bidang sisi?</label>
          <small>(Hitung semua permukaan datar: alas + tutup + sisi tegak)</small>
          <div class="input-row">
            <input id="faces-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('faces')">Cek</button>
          </div>
          <div id="faces-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üìè Berapa jumlah rusuk?</label>
          <small>(Garis tepi pertemuan dua bidang sisi)</small>
          <div class="input-row">
            <input id="edges-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('edges')">Cek</button>
          </div>
          <div id="edges-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üìç Berapa jumlah titik sudut?</label>
          <small>(Titik pertemuan tiga atau lebih rusuk)</small>
          <div class="input-row">
            <input id="vertices-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('vertices')">Cek</button>
          </div>
          <div id="vertices-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>‚ÜóÔ∏è Berapa jumlah diagonal bidang (pada semua sisi)?</label>
          <small>(Garis lurus di dalam satu sisi: alas, tutup, dan sisi tegak)</small>
          <div class="input-row">
            <input id="face-diagonals-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('faceDiagonals')">Cek</button>
          </div>
          <div id="face-diagonals-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>‚ú® Berapa jumlah diagonal ruang?</label>
          <small>(Garis yang menghubungkan dua titik sudut yang tidak satu bidang dan melintas di dalam bangun)</small>
          <div class="input-row">
            <input id="space-diagonals-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('spaceDiagonals')">Cek</button>
          </div>
          <div id="space-diagonals-feedback" class="feedback"></div>
        </div>

        <div class="q-card">
          <label>üü™ Berapa jumlah bidang diagonal?</label>
          <small>(Daerah transparan yang dibatasi dua diagonal bidang dan dua rusuk tegak yang berhadapan)</small>
          <div class="input-row">
            <input id="diagonal-planes-input" type="number" class="input" placeholder="Jawaban"/>
            <button class="primary" onclick="checkAnswer('diagonalPlanes')">Cek</button>
          </div>
          <div id="diagonal-planes-feedback" class="feedback"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px;">
      <h4 class="panel-title">üßÆ Temukan Pola dan Rumus!</h4>
      <p class="subtle">Isi tabel ketika jawabanmu benar untuk setiap jenis prisma. Lihat polanya lalu lengkapi rumus umum segi-n.</p>
      <div style="overflow:auto; border:1px solid #e5e7eb; border-radius:12px;">
        <table>
          <thead>
            <tr>
              <th>Jenis Prisma</th>
              <th>Sisi Alas (n)</th>
              <th>Bidang Sisi</th>
              <th>Rusuk</th>
              <th>Titik Sudut</th>
              <th>Diagonal Bidang (semua sisi)</th>
              <th>Diagonal Ruang</th>
              <th>Bidang Diagonal</th>
            </tr>
          </thead>
          <tbody id="formula-table-body"></tbody>
        </table>
      </div>

      <div style="margin-top:14px; padding:12px; border:2px solid #e5e7eb; border-radius:12px;">
        <h4 class="panel-title">üéØ Tantangan Rumus Prisma Segi-n</h4>
        <div style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); margin-top:8px;">
          <div class="q-card" style="margin:0;">
            <label>Bidang Sisi =</label>
            <div class="input-row">
              <input id="faces-formula" class="input" placeholder="n + ?"/>
              <button class="primary" onclick="checkFormula('faces')">Cek</button>
            </div>
            <div id="faces-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Rusuk =</label>
            <div class="input-row">
              <input id="edges-formula" class="input" placeholder="?n"/>
              <button class="primary" onclick="checkFormula('edges')">Cek</button>
            </div>
            <div id="edges-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Titik Sudut =</label>
            <div class="input-row">
              <input id="vertices-formula" class="input" placeholder="?n"/>
              <button class="primary" onclick="checkFormula('vertices')">Cek</button>
            </div>
            <div id="vertices-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Diagonal Bidang (semua sisi) =</label>
            <div class="input-row">
              <input id="base-diag-formula" class="input" placeholder="n(n-1)"/>
              <button class="primary" onclick="checkFormula('baseDiag')">Cek</button>
            </div>
            <div id="base-diag-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Diagonal Ruang =</label>
            <div class="input-row">
              <input id="space-diag-formula" class="input" placeholder="n(n-?)"/>
              <button class="primary" onclick="checkFormula('spaceDiag')">Cek</button>
            </div>
            <div id="space-diag-formula-feedback" class="feedback"></div>
          </div>
          <div class="q-card" style="margin:0;">
            <label>Bidang Diagonal =</label>
            <div class="input-row">
              <input id="plane-formula" class="input" placeholder="n(n-?)/?"/>
              <button class="primary" onclick="checkFormula('plane')">Cek</button>
            </div>
            <div id="plane-formula-feedback" class="feedback"></div>
          </div>
        </div>

        <div id="final-formulas" style="display:none; margin-top:12px; background:linear-gradient(135deg,#eef2ff,#ecfdf5); padding:12px; border-radius:12px; border:2px solid #d1fae5;">
          <h4 class="panel-title">üéâ Rumus Umum Prisma Segi-n</h4>
          <div style="display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(180px,1fr));">
            <div class="card" style="margin:0; background:#fff;">Bidang Sisi: <strong style="color:#4338ca;">n + 2</strong></div>
            <div class="card" style="margin:0; background:#fff;">Rusuk: <strong style="color:#4338ca;">3n</strong></div>
            <div class="card" style="margin:0; background:#fff;">Titik Sudut: <strong style="color:#4338ca;">2n</strong></div>
            <div class="card" style="margin:0; background:#fff;">Diagonal Bidang: <strong style="color:#4338ca;">n(n‚àí1)</strong></div>
            <div class="card" style="margin:0; background:#fff;">Diagonal Ruang: <strong style="color:#4338ca;">n(n‚àí3)</strong></div>
            <div class="card" style="margin:0; background:#fff;">Bidang Diagonal: <strong style="color:#4338ca;">n(n‚àí3)/2</strong></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    let scene, camera, renderer, controls;
    let currentGroup = null;
    let currentShapeType = 'triangle';
    let completedShapes = new Set();
    let correctFormulas = 0;

    let baseBottom = [];
    let baseTop = [];

    // Data prisma (mengikuti definisi terbaru)
    // Diagonal bidang (semua sisi) = n(n-3) + 2n = n(n-1)
    // Diagonal ruang = n(n-3)
    // Bidang diagonal = n(n-3)/2
    const shapeData = {
      triangle: { name: 'Prisma Segitiga', sides: 3, faces: 5, edges: 9, vertices: 6, faceDiagonals: 3*(3-1), spaceDiagonals: 3*(3-3), diagonalPlanes: 3*(3-3)/2 },
      square:   { name: 'Prisma Segiempat', sides: 4, faces: 6, edges: 12, vertices: 8, faceDiagonals: 4*(4-1), spaceDiagonals: 4*(4-3), diagonalPlanes: 4*(4-3)/2 },
      pentagon: { name: 'Prisma Segilima', sides: 5, faces: 7, edges: 15, vertices: 10, faceDiagonals: 5*(5-1), spaceDiagonals: 5*(5-3), diagonalPlanes: 5*(5-3)/2 },
      hexagon:  { name: 'Prisma Segienam', sides: 6, faces: 8, edges: 18, vertices: 12, faceDiagonals: 6*(6-1), spaceDiagonals: 6*(6-3), diagonalPlanes: 6*(6-3)/2 },
      octagon:  { name: 'Prisma Segidelapan', sides: 8, faces: 10, edges: 24, vertices: 16, faceDiagonals: 8*(8-1), spaceDiagonals: 8*(8-3), diagonalPlanes: 8*(8-3)/2 },
      decagon:  { name: 'Prisma Sepuluh', sides: 10, faces: 12, edges: 30, vertices: 20, faceDiagonals: 10*(10-1), spaceDiagonals: 10*(10-3), diagonalPlanes: 10*(10-3)/2 }
    };

    function showToast(msg, ms = 2200) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.display = 'block';
      setTimeout(() => { t.style.display = 'none'; }, ms);
    }

    function initThree() {
      const container = document.getElementById('threejs-container');
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf5f7fb);

      camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(6, 5.5, 6);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;

      const amb = new THREE.AmbientLight(0xffffff, 0.7);
      scene.add(amb);
      const dir = new THREE.DirectionalLight(0xffffff, 0.8);
      dir.position.set(5, 10, 6);
      scene.add(dir);

      createPrism('triangle');
      animate();

      window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });
    }

    function clearHintsUI() {
      document.getElementById('toggle-base-diag').checked = false;
      document.getElementById('toggle-space-diag').checked = false;
      document.getElementById('toggle-diagonal-plane').checked = false;
      document.getElementById('toggle-show-faces').checked = false;
      document.getElementById('toggle-show-edges').checked = false;
      document.getElementById('toggle-show-vertices').checked = false;
    }

    function createPrism(shapeType) {
      if (currentGroup) scene.remove(currentGroup);
      clearHintsUI();

      currentShapeType = shapeType;
      const sides = shapeData[shapeType].sides;
      const radius = 1.6;
      const height = 3;

      baseBottom = [];
      baseTop = [];
      for (let i = 0; i < sides; i++) {
        const a = (i / sides) * Math.PI * 2;
        baseBottom.push(new THREE.Vector3(Math.cos(a) * radius, -height/2, Math.sin(a) * radius));
        baseTop.push(new THREE.Vector3(Math.cos(a) * radius,  height/2, Math.sin(a) * radius));
      }

      // Bentuk prisma (extrude)
      const shape2D = new THREE.Shape();
      for (let i = 0; i < sides; i++) {
        const p = baseBottom[i].clone(); p.y = 0;
        if (i === 0) shape2D.moveTo(p.x, p.z);
        else shape2D.lineTo(p.x, p.z);
      }
      const geom = new THREE.ExtrudeGeometry(shape2D, { depth: height, bevelEnabled: false });
      geom.rotateX(-Math.PI/2);
      geom.translate(0, -height/2, 0);

      const group = new THREE.Group();
      const mesh = new THREE.Mesh(
        geom,
        new THREE.MeshLambertMaterial({ color: 0x9ec5fe, transparent: true, opacity: 0.85, side: THREE.DoubleSide })
      );
      group.add(mesh);

      const wire = new THREE.LineSegments(
        new THREE.EdgesGeometry(geom),
        new THREE.LineBasicMaterial({ color: 0x111111, linewidth: 2 })
      );
      group.add(wire);

      // Grup petunjuk
      group.userData.baseDiag = new THREE.Group();     // kuning: semua sisi
      group.userData.spaceDiag = new THREE.Group();    // pink: diagonal ruang
      group.userData.diagPlane = new THREE.Group();    // ungu: bidang diagonal

      // Simpan referensi untuk saklar Sisi / Rusuk / Titik Sudut
      group.userData.mesh = mesh;
      group.userData.wire = wire;
      group.userData.verts = buildVerticesGroup();

      // Tambahkan grup titik sudut (awal disembunyikan)
      group.userData.verts.visible = false;
      group.add(group.userData.verts);

      buildBaseDiagonals(group.userData.baseDiag);
      buildSpaceDiagonals(group.userData.spaceDiag);
      buildDiagonalPlanes(group.userData.diagPlane);

      currentGroup = group;
      scene.add(group);

      // Set default tampilan: Sisi & Rusuk aktif, Titik Sudut non-aktif
      document.getElementById('toggle-show-faces').checked = true;
      document.getElementById('toggle-show-edges').checked = true;
      document.getElementById('toggle-show-vertices').checked = false;
      currentGroup.userData.mesh.visible = true;
      currentGroup.userData.wire.visible = true;

      document.getElementById('shape-name').textContent = shapeData[shapeType].name;
      resetInputs();
    }

    function lineBetween(p1, p2, color) {
      const geo = new THREE.BufferGeometry().setFromPoints([p1, p2]);
      const mat = new THREE.LineBasicMaterial({ color, linewidth: 3 });
      return new THREE.Line(geo, mat);
    }

    // Buat titik sudut (bola kecil hijau di semua sudut)
    function buildVerticesGroup() {
      const group = new THREE.Group();
      const mat = new THREE.MeshBasicMaterial({ color: 0x10b981 });
      const sphere = new THREE.SphereGeometry(0.06, 16, 16);
      [...baseBottom, ...baseTop].forEach(v => {
        const s = new THREE.Mesh(sphere, mat);
        s.position.copy(v);
        group.add(s);
      });
      return group;
    }

    // Diagonal bidang (semua sisi: alas, tutup, dan sisi tegak)
    function buildBaseDiagonals(group) {
      const color = 0xfbbf24;
      const n = baseBottom.length;
      if (n < 4) {
        // sisi tegak tetap punya 2 diagonal per sisi untuk n=3
        for (let i = 0; i < n; i++) {
          const next = (i + 1) % n;
          group.add(lineBetween(baseBottom[i], baseTop[next], color));
          group.add(lineBetween(baseBottom[next], baseTop[i], color));
        }
        return;
      }
      // alas
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          const isNeighbor = (j === i + 1) || (i === 0 && j === n - 1);
          if (isNeighbor) continue;
          group.add(lineBetween(baseBottom[i], baseBottom[j], color));
        }
      }
      // tutup
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          const isNeighbor = (j === i + 1) || (i === 0 && j === n - 1);
          if (isNeighbor) continue;
          group.add(lineBetween(baseTop[i], baseTop[j], color));
        }
      }
      // sisi tegak (persegi panjang): dua diagonal per sisi
      for (let i = 0; i < n; i++) {
        const next = (i + 1) % n;
        group.add(lineBetween(baseBottom[i], baseTop[next], color));
        group.add(lineBetween(baseBottom[next], baseTop[i], color));
      }
    }

    // Diagonal ruang (alas ‚Üí tutup yang tidak sebidang sisi tegak mana pun)
    function buildSpaceDiagonals(group) {
      const color = 0xec4899;
      const n = baseBottom.length;
      for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
          const neighbor = (j === i) || (j === (i + 1) % n) || (j === (i - 1 + n) % n);
          if (neighbor) continue; // singkirkan rusuk tegak dan diagonal pada sisi tegak
          group.add(lineBetween(baseBottom[i], baseTop[j], color));
        }
      }
    }

    // Bidang diagonal: quad dari (bottom i ‚Üí bottom j ‚Üí top j ‚Üí top i) untuk setiap diagonal alas (i,j) yang tidak bertetangga
    function buildDiagonalPlanes(group) {
      const n = baseBottom.length;
      if (n < 4) return; // segitiga tidak punya bidang diagonal berbasis diagonal alas
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          const isNeighbor = (j === i + 1) || (i === 0 && j === n - 1);
          if (isNeighbor) continue;
          const b1 = baseBottom[i], b2 = baseBottom[j], t2 = baseTop[j], t1 = baseTop[i];

          const planeGeom = new THREE.BufferGeometry();
          const verts = new Float32Array([
            b1.x, b1.y, b1.z,
            b2.x, b2.y, b2.z,
            t2.x, t2.y, t2.z,

            b1.x, b1.y, b1.z,
            t2.x, t2.y, t2.z,
            t1.x, t1.y, t1.z
          ]);
          planeGeom.setAttribute('position', new THREE.BufferAttribute(verts, 3));
          planeGeom.computeVertexNormals();

          const mat = new THREE.MeshBasicMaterial({ color: 0xa855f7, transparent: true, opacity: 0.25, side: THREE.DoubleSide });
          const plane = new THREE.Mesh(planeGeom, mat);

          const edges = new THREE.LineSegments(
            new THREE.EdgesGeometry(planeGeom),
            new THREE.LineBasicMaterial({ color: 0x6d28d9 })
          );

          const planeGroup = new THREE.Group();
          planeGroup.add(plane);
          planeGroup.add(edges);
          group.add(planeGroup);
        }
      }
    }

    // Toggle petunjuk & tampilan dasar
    document.addEventListener('change', (e) => {
      if (!currentGroup) return;

      if (e.target.id === 'toggle-base-diag') {
        if (e.target.checked) scene.add(currentGroup.userData.baseDiag);
        else scene.remove(currentGroup.userData.baseDiag);
      }
      if (e.target.id === 'toggle-space-diag') {
        if (e.target.checked) {
          scene.add(currentGroup.userData.spaceDiag);
          showToast('Diagonal ruang: menghubungkan dua titik sudut yang tidak satu bidang dan melintasi bagian dalam bangun.');
        } else {
          scene.remove(currentGroup.userData.spaceDiag);
        }
      }
      if (e.target.id === 'toggle-diagonal-plane') {
        if (e.target.checked) {
          scene.add(currentGroup.userData.diagPlane);
          showToast('Bidang diagonal: dibatasi dua diagonal bidang sejajar dan dua rusuk tegak yang berhadapan.');
        } else {
          scene.remove(currentGroup.userData.diagPlane);
        }
      }

      if (e.target.id === 'toggle-show-faces') {
        currentGroup.userData.mesh.visible = e.target.checked;
      }
      if (e.target.id === 'toggle-show-edges') {
        currentGroup.userData.wire.visible = e.target.checked;
      }
      if (e.target.id === 'toggle-show-vertices') {
        currentGroup.userData.verts.visible = e.target.checked;
      }
    });

    // Pilih bentuk
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.btn[data-shape]');
      if (!btn) return;
      document.querySelectorAll('.btn[data-shape]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      createPrism(btn.dataset.shape);
    });

    // Tanya-jawab interaktif
    function feedback(el, ok, msg) {
      el.className = 'feedback ' + (ok ? 'ok' : 'no');
      el.textContent = msg;
    }

    function checkAnswer(property) {
      let id, fb;
      if (property === 'faceDiagonals') { id = 'face-diagonals-input'; fb = 'face-diagonals-feedback'; }
      else if (property === 'spaceDiagonals') { id = 'space-diagonals-input'; fb = 'space-diagonals-feedback'; }
      else if (property === 'diagonalPlanes') { id = 'diagonal-planes-input'; fb = 'diagonal-planes-feedback'; }
      else { id = property + '-input'; fb = property + '-feedback'; }

      const input = document.getElementById(id);
      const feed = document.getElementById(fb);
      const user = parseInt(input.value, 10);
      const correct = shapeData[currentShapeType][property];

      if (user === correct) {
        feedback(feed, true, '‚úÖ Benar! Keren.');
        input.disabled = true; input.style.background = '#ecfdf5';
        setTimeout(checkAllAnswersComplete, 120);
      } else {
        let tip = '';
        if (property === 'faceDiagonals') tip = 'Nyalakan ‚ÄúDiagonal Bidang‚Äù lalu hitung pada semua sisi.';
        if (property === 'spaceDiagonals') tip = 'Nyalakan ‚ÄúDiagonal Ruang‚Äù dan amati garis yang melintas di dalam bangun.';
        if (property === 'diagonalPlanes') tip = 'Nyalakan ‚ÄúBidang Diagonal‚Äù lalu hitung bidang transparan ungu.';
        feedback(feed, false, '‚ùå Belum tepat. ' + tip);
      }
    }

    function checkAllAnswersComplete() {
      const props = ['sides','faces','edges','vertices','faceDiagonals','spaceDiagonals','diagonalPlanes'];
      let all = true;
      props.forEach(p => {
        const id = (p === 'faceDiagonals') ? 'face-diagonals-input'
                : (p === 'spaceDiagonals') ? 'space-diagonals-input'
                : (p === 'diagonalPlanes') ? 'diagonal-planes-input'
                : (p + '-input');
        if (!document.getElementById(id).disabled) all = false;
      });
      if (all && !completedShapes.has(currentShapeType)) {
        completedShapes.add(currentShapeType);
        addToTable();
      }
    }

    function addToTable() {
      const tb = document.getElementById('formula-table-body');
      const d = shapeData[currentShapeType];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${d.name.replace('Prisma ', '')}</td>
        <td>${d.sides}</td>
        <td>${d.faces}</td>
        <td>${d.edges}</td>
        <td>${d.vertices}</td>
        <td>${d.faceDiagonals}</td>
        <td>${d.spaceDiagonals}</td>
        <td>${d.diagonalPlanes}</td>
      `;
      tb.appendChild(tr);
      tr.style.background = '#fff7ed';
      setTimeout(()=>{ tr.style.background = ''; }, 1600);
    }

    function resetInputs() {
      const pairs = [
        ['sides-input','sides-feedback'],
        ['faces-input','faces-feedback'],
        ['edges-input','edges-feedback'],
        ['vertices-input','vertices-feedback'],
        ['face-diagonals-input','face-diagonals-feedback'],
        ['space-diagonals-input','space-diagonals-feedback'],
        ['diagonal-planes-input','diagonal-planes-feedback'],
      ];
      pairs.forEach(([inp, fb]) => {
        const el = document.getElementById(inp);
        const fe = document.getElementById(fb);
        el.value=''; el.disabled=false; el.style.background='';
        fe.className='feedback'; fe.textContent='';
      });
    }

    function checkFormula(type) {
      const id = (type === 'faces') ? 'faces-formula'
              : (type === 'edges') ? 'edges-formula'
              : (type === 'vertices') ? 'vertices-formula'
              : (type === 'baseDiag') ? 'base-diag-formula'
              : (type === 'spaceDiag') ? 'space-diag-formula'
              : 'plane-formula';
      const fb = id + '-feedback';
      const input = document.getElementById(id);
      const feed = document.getElementById(fb);
      const ans = (input.value || '').toLowerCase().replace(/\s/g,'');

      let correct = '';
      if (type === 'faces') correct = 'n+2';
      if (type === 'edges') correct = '3n';
      if (type === 'vertices') correct = '2n';
      if (type === 'baseDiag') correct = 'n(n-1)';
      if (type === 'spaceDiag') correct = 'n(n-3)';
      if (type === 'plane') correct = 'n(n-3)/2';

      if (ans === correct) {
        feed.className = 'feedback ok';
        feed.textContent = '‚úÖ Benar!';
        input.disabled = true; input.style.background = '#ecfdf5';
        correctFormulas++;
        if (correctFormulas === 6) document.getElementById('final-formulas').style.display = 'block';
      } else {
        feed.className = 'feedback no';
        feed.textContent = '‚ùå Coba cocokkan dengan pola di tabel.';
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    window.addEventListener('load', initThree);
  </script>
</body>
</html>
